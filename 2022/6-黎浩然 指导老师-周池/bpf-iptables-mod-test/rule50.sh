#!/bin/bash

CHAIN="INPUT"

if [ "$1" == "pcn-iptables" ]; then
    echo "Using bpf-iptables"
    IPTABLES="pcn-iptables"
    polycubectl pcn-iptables set interactive=false
elif [ "$1" == "iptables" ]; then
    echo "Using iptables"
    IPTABLES="sudo iptables"
else
    echo ""
    echo "usage:"
    echo "$0 [iptables|pcn-iptables|nftables] [FORWARD]"
    echo ""
    exit 1
fi

$IPTABLES -P $CHAIN ACCEPT
$IPTABLES -A $CHAIN -s 192.168.6.131 -d 192.168.6.127 -p tcp -j ACCEPT
$IPTABLES -A $CHAIN -s 192.168.6.131 -d 192.168.6.126 -p tcp -j ACCEPT
$IPTABLES -A $CHAIN -s 192.168.6.131 -d 192.168.6.126 -p tcp -j ACCEPT
$IPTABLES -A $CHAIN -s 192.168.6.131 -d 192.168.6.126 -p tcp -j ACCEPT
$IPTABLES -A $CHAIN -s 192.168.6.131 -d 192.168.6.126 -p tcp -j ACCEPT
$IPTABLES -A $CHAIN -s 192.168.6.131 -d 192.168.6.128 -p tcp -j ACCEPT
$IPTABLES -A $CHAIN -s 192.168.6.131 -d 192.168.6.128 -p tcp -j ACCEPT
$IPTABLES -A $CHAIN -s 192.168.6.131 -d 192.168.6.128 -p tcp -j ACCEPT
$IPTABLES -A $CHAIN -s 192.168.6.131 -d 192.168.6.128 -p tcp -j ACCEPT
$IPTABLES -A $CHAIN -s 192.168.6.132 -d 192.168.6.131 -p tcp -j ACCEPT
$IPTABLES -A $CHAIN -s 192.168.6.132 -d 192.168.6.131 -p tcp -j ACCEPT
$IPTABLES -A $CHAIN -s 192.168.6.132 -d 192.168.6.131 -p tcp -j ACCEPT
$IPTABLES -A $CHAIN -s 192.168.6.132 -d 192.168.6.131 -p tcp -j ACCEPT
$IPTABLES -A $CHAIN -s 192.168.6.132 -d 192.168.6.131 -p tcp -j ACCEPT
$IPTABLES -A $CHAIN -s 192.168.6.132 -d 192.168.6.131 -p tcp -j ACCEPT
$IPTABLES -A $CHAIN -s 192.168.6.132 -d 192.168.6.131 -p tcp -j ACCEPT
$IPTABLES -A $CHAIN -s 192.168.6.132 -d 192.168.6.131 -p tcp -j ACCEPT
$IPTABLES -A $CHAIN -s 192.168.6.132 -d 192.168.6.127 -p tcp -j ACCEPT
$IPTABLES -A $CHAIN -s 192.168.6.132 -d 192.168.6.127 -p tcp -j ACCEPT
$IPTABLES -A $CHAIN -s 192.168.6.132 -d 192.168.6.127 -p tcp -j ACCEPT
$IPTABLES -A $CHAIN -s 192.168.6.132 -d 192.168.6.127 -p tcp -j ACCEPT
$IPTABLES -A $CHAIN -s 192.168.6.132 -d 192.168.6.126 -p tcp -j ACCEPT
$IPTABLES -A $CHAIN -s 192.168.6.132 -d 192.168.6.126 -p tcp -j ACCEPT
$IPTABLES -A $CHAIN -s 192.168.6.132 -d 192.168.6.126 -p tcp -j ACCEPT
$IPTABLES -A $CHAIN -s 192.168.6.132 -d 192.168.6.126 -p tcp -j ACCEPT
$IPTABLES -A $CHAIN -s 192.168.6.132 -d 192.168.6.128 -p tcp -j ACCEPT
$IPTABLES -A $CHAIN -s 192.168.6.132 -d 192.168.6.128 -p tcp -j ACCEPT
$IPTABLES -A $CHAIN -s 192.168.6.132 -d 192.168.6.128 -p tcp -j ACCEPT
$IPTABLES -A $CHAIN -s 192.168.6.132 -d 192.168.6.128 -p tcp -j ACCEPT
$IPTABLES -A $CHAIN -s 192.168.6.132 -d 192.168.6.131 -p tcp -j ACCEPT
$IPTABLES -A $CHAIN -s 192.168.6.132 -d 192.168.6.131 -p tcp -j ACCEPT
$IPTABLES -A $CHAIN -s 192.168.6.132 -d 192.168.6.131 -p tcp -j ACCEPT
$IPTABLES -A $CHAIN -s 192.168.6.132 -d 192.168.6.131 -p tcp -j ACCEPT
$IPTABLES -A $CHAIN -s 192.168.6.132 -d 192.168.6.131 -p tcp -j ACCEPT
$IPTABLES -A $CHAIN -s 192.168.6.132 -d 192.168.6.131 -p tcp -j ACCEPT
$IPTABLES -A $CHAIN -s 192.168.6.132 -d 192.168.6.131 -p tcp -j ACCEPT
$IPTABLES -A $CHAIN -s 192.168.6.132 -d 192.168.6.131 -p tcp -j ACCEPT
$IPTABLES -A $CHAIN -s 192.168.6.132 -d 192.168.6.127 -p tcp -j ACCEPT
$IPTABLES -A $CHAIN -s 192.168.6.132 -d 192.168.6.127 -p tcp -j ACCEPT
$IPTABLES -A $CHAIN -s 192.168.6.132 -d 192.168.6.127 -p tcp -j ACCEPT
$IPTABLES -A $CHAIN -s 192.168.6.132 -d 192.168.6.127 -p tcp -j ACCEPT
$IPTABLES -A $CHAIN -s 192.168.6.132 -d 192.168.6.126 -p tcp -j ACCEPT
$IPTABLES -A $CHAIN -s 192.168.6.132 -d 192.168.6.126 -p tcp -j ACCEPT
$IPTABLES -A $CHAIN -s 192.168.6.132 -d 192.168.6.126 -p tcp -j ACCEPT
$IPTABLES -A $CHAIN -s 192.168.6.132 -d 192.168.6.126 -p tcp -j ACCEPT
$IPTABLES -A $CHAIN -s 192.168.6.132 -d 192.168.6.128 -p tcp -j ACCEPT
$IPTABLES -A $CHAIN -s 192.168.6.132 -d 192.168.6.128 -p tcp -j ACCEPT
$IPTABLES -A $CHAIN -s 192.168.6.132 -d 192.168.6.128 -p tcp -j ACCEPT
$IPTABLES -A $CHAIN -s 192.168.6.132 -d 192.168.6.128 -p tcp -j ACCEPT
$IPTABLES -A $CHAIN -s 192.168.6.130 -d 192.168.6.131 -p tcp -j ACCEPT

if [ "$1" == "pcn-iptables" ];
then
    polycubectl pcn-iptables chain $CHAIN apply-rules
fi
